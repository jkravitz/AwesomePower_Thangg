<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no" />
    <title>jQuery UI Resizable - Default functionality</title>
    <link rel="stylesheet" type="text/css" href="jquery/css/ui-lightness/jquery-ui-1.10.2.custom.min.css">
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <script  src="jquery/js/jquery-1.9.1.js"></script>
    <script  src="jquery/js/jquery-ui-1.10.2.custom.js"></script>
    <script  src="jquery/js/jquery.ui.touch-punch.js"></script>
	<script  src="./js/items.js"></script>
    <style>
        
		#leftcolumn {
			padding: 0px 10px;
		}
			
    </style>
    <script>
		$(function() {
            $(document).on('click', '.remoteButton', function() {
				event.preventDefault();
				localStorage.prevPage = "overview.html";
                window.location = "index.html";
            });
            $(document).on('click', '#plusSchedule', function() {
                event.preventDefault();
				localStorage.prevPage = "overview.html";
                window.location = "chooseDevice.html";
            });
            $(document).on('click', '.device', function() {
				$(this).css("box-shadow","0px 0px 10px #fff");
				localStorage.currentSchedule = $(this).attr('id');
                event.preventDefault();	
				localStorage.prevPage = "overview.html";
				window.location = "schedule.html";
            });
        });
		
		
    </script>
</head>
    
<body class="overview">
    <div id="header">
		<div class="leftButton button remoteButton"><span>Back</span></div>
        <div class="midContainer"><h1 id="pageTitle" >Schedules</h1></div>
		<div class="rightButton button remoteButton"><span>Remote</span></div>
    </div>
    <div id="leftcolumn"></div>
	<div class="addSchedule">
		<img src="img/plus2.png" alt="plus" id="plusSchedule">
	</div>
	
	<script>
		function timeStringToPercent(time) {
			var patt1=/[^\.]/g;
			var numArray = time.match(patt1);
					
			var hour = numArray[0] + "" + numArray[1];
			var minute = numArray[2] + "" + numArray[3];
			var totalMinutes = hour*60 + minute;
					
			return totalMinutes/1440;
		}
		
		function capitalizeFirstLetter(string) {
			return string.charAt(0).toUpperCase() + string.slice(1);
		}
		
			
		for (var item in items) {
			var idItem = item;
			
			if (items[item].hasSchedule == 'yes') {
				var createHTML = 
				'<div class="device" id="'+idItem+'">'+
					'<div class="deviceImage"><span>'+items[item].name+'</span><img src="'+items[item].image+'" /></div>'+
					'<div class="deviceSchedule">';
					
				for (var day in items[item].schedule) {
					var classDay = day;
					
					createHTML = createHTML + 
						'<div class="'+classDay+'">' + 
							'<div class="day">'+
								capitalizeFirstLetter(classDay) + 
							'</div>' + 
							'<div class="time">';
				
					for (var i=0;i<items[item].schedule[day].length;i = i+2) {
						var begin = items[item].schedule[day][i];
						var end = items[item].schedule[day][i+1];					
						var startPercent = timeStringToPercent(begin);
						var endPercent  = timeStringToPercent(end);						
						var widthPercent = endPercent - startPercent;
						
						createHTML = createHTML + 
							"<div style=\"width: "+widthPercent+"%; "+
								"left: "+startPercent+"%; \"></div>";
					}
					
					createHTML = createHTML + 
						'</div></div>';
				
				}
				createHTML = createHTML + 
						'</div></div>';	

				$("#leftcolumn").append(createHTML);
			}
		}
				
		
	</script>
</body>
</html>
